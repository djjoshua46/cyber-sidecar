events {}

http {
  upstream sidecar {
    server sidecar:8080;
  }

  server {
    listen 8080;

    # Mimic customer “edge” by setting THEIR header names.
    # You can customize these per-customer later.
    location /proxy/http {
      proxy_pass http://sidecar/proxy/http;

      proxy_set_header X-Org-Id      "org-1";
      proxy_set_header X-User-Id     "user-1";
      proxy_set_header X-Session-Id  "sess-1";
      proxy_set_header X-Device-Id   "dev-1";
      proxy_set_header User-Agent    "customer/edge-proxy";

      # Forward content-type for POST JSON
      proxy_set_header Content-Type  $http_content_type;
    }

    location /health {
      proxy_pass http://sidecar/health;
    }
  }
}
